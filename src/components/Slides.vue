<template>
  <div>
    <app-secondary-nav></app-secondary-nav>
    <div class="container-fluid">
      <div id="slides-wrap" class="row">
        <div id="slide-1"
          class="d-flex flex-row flex-wrap justify-content-center align-content-center
            slide animated slide-1"
        >
          <div class="align-self-center content title">
            <h2 class="text-center">Customer Problem</h2>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
          </div>
        </div>
        <div id="slide-2"
          class="d-flex flex-row flex-wrap justify-content-center align-content-center
            slide hide-slide animated slide-2"
        >
          <div class="align-self-center content info">
            <h2 class="text-center">Business Problem</h2>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Integer nisl arcu, tincidunt at finibus et, hendrerit eget arcu.
              Proin in enim pretium, convallis purus ut, ultrices lorem.
              Mauris dolor purus, porttitor in lorem nec, malesuada ornare massa.
              Quisque eget sollicitudin arcu, et elementum dolor.
              Nunc ut metus arcu. Nunc tempus pellentesque efficitur.
              Etiam tristique efficitur ex ac varius.
              Nulla iaculis neque eget interdum pretium. Duis porttitor in elit sit amet bibendum.
              Fusce euismod arcu sed elit molestie, id cursus lacus sagittis.
              Donec tortor lorem, aliquet ut leo vulputate, vulputate commodo justo.
              Cras ut ligula et quam venenatis tristique eu non massa.
              Suspendisse at lectus ut felis mollis mattis quis vitae ex.
              Sed sed purus id dolor eleifend consectetur. Aliquam erat volutpat.
              Vestibulum accumsan orci dolor, id bibendum orci congue eu.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Integer nisl arcu, tincidunt at finibus et, hendrerit eget arcu.
              Proin in enim pretium, convallis purus ut, ultrices lorem.
              Mauris dolor purus, porttitor in lorem nec, malesuada ornare massa.
              Quisque eget sollicitudin arcu, et elementum dolor.
              Nunc ut metus arcu. Nunc tempus pellentesque efficitur.
              Etiam tristique efficitur ex ac varius.
              Nulla iaculis neque eget interdum pretium. Duis porttitor in elit sit amet bibendum.
              Fusce euismod arcu sed elit molestie, id cursus lacus sagittis.
              Donec tortor lorem, aliquet ut leo vulputate, vulputate commodo justo.
              Cras ut ligula et quam venenatis tristique eu non massa.
              Suspendisse at lectus ut felis mollis mattis quis vitae ex.
              Sed sed purus id dolor eleifend consectetur. Aliquam erat volutpat.
              Vestibulum accumsan orci dolor, id bibendum orci congue eu.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Integer nisl arcu, tincidunt at finibus et, hendrerit eget arcu.
              Proin in enim pretium, convallis purus ut, ultrices lorem.
              Mauris dolor purus, porttitor in lorem nec, malesuada ornare massa.
              Quisque eget sollicitudin arcu, et elementum dolor.
              Nunc ut metus arcu. Nunc tempus pellentesque efficitur.
              Etiam tristique efficitur ex ac varius.
              Nulla iaculis neque eget interdum pretium. Duis porttitor in elit sit amet bibendum.
              Fusce euismod arcu sed elit molestie, id cursus lacus sagittis.
              Donec tortor lorem, aliquet ut leo vulputate, vulputate commodo justo.
              Cras ut ligula et quam venenatis tristique eu non massa.
              Suspendisse at lectus ut felis mollis mattis quis vitae ex.
              Sed sed purus id dolor eleifend consectetur. Aliquam erat volutpat.
              Vestibulum accumsan orci dolor, id bibendum orci congue eu.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Integer nisl arcu, tincidunt at finibus et, hendrerit eget arcu.
              Proin in enim pretium, convallis purus ut, ultrices lorem.
              Mauris dolor purus, porttitor in lorem nec, malesuada ornare massa.
              Quisque eget sollicitudin arcu, et elementum dolor.
              Nunc ut metus arcu. Nunc tempus pellentesque efficitur.
              Etiam tristique efficitur ex ac varius.
              Nulla iaculis neque eget interdum pretium. Duis porttitor in elit sit amet bibendum.
              Fusce euismod arcu sed elit molestie, id cursus lacus sagittis.
              Donec tortor lorem, aliquet ut leo vulputate, vulputate commodo justo.
              Cras ut ligula et quam venenatis tristique eu non massa.
              Suspendisse at lectus ut felis mollis mattis quis vitae ex.
              Sed sed purus id dolor eleifend consectetur. Aliquam erat volutpat.
              Vestibulum accumsan orci dolor, id bibendum orci congue eu.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Integer nisl arcu, tincidunt at finibus et, hendrerit eget arcu.
              Proin in enim pretium, convallis purus ut, ultrices lorem.
              Mauris dolor purus, porttitor in lorem nec, malesuada ornare massa.
              Quisque eget sollicitudin arcu, et elementum dolor.
              Nunc ut metus arcu. Nunc tempus pellentesque efficitur.
              Etiam tristique efficitur ex ac varius.
              Nulla iaculis neque eget interdum pretium. Duis porttitor in elit sit amet bibendum.
              Fusce euismod arcu sed elit molestie, id cursus lacus sagittis.
              Donec tortor lorem, aliquet ut leo vulputate, vulputate commodo justo.
              Cras ut ligula et quam venenatis tristique eu non massa.
              Suspendisse at lectus ut felis mollis mattis quis vitae ex.
              Sed sed purus id dolor eleifend consectetur. Aliquam erat volutpat.
              Vestibulum accumsan orci dolor, id bibendum orci congue eu.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Integer nisl arcu, tincidunt at finibus et, hendrerit eget arcu.
              Proin in enim pretium, convallis purus ut, ultrices lorem.
              Mauris dolor purus, porttitor in lorem nec, malesuada ornare massa.
              Quisque eget sollicitudin arcu, et elementum dolor.
              Nunc ut metus arcu. Nunc tempus pellentesque efficitur.
              Etiam tristique efficitur ex ac varius.
              Nulla iaculis neque eget interdum pretium. Duis porttitor in elit sit amet bibendum.
              Fusce euismod arcu sed elit molestie, id cursus lacus sagittis.
              Donec tortor lorem, aliquet ut leo vulputate, vulputate commodo justo.
              Cras ut ligula et quam venenatis tristique eu non massa.
              Suspendisse at lectus ut felis mollis mattis quis vitae ex.
              Sed sed purus id dolor eleifend consectetur. Aliquam erat volutpat.
              Vestibulum accumsan orci dolor, id bibendum orci congue eu.
            </p>
            <p>THE END</p>
          </div>
        </div>
        <div id="slide-3"
          class="d-flex flex-row flex-wrap justify-content-center align-content-center
            slide hide-slide animated slide-3"
        >
          <div class="align-self-center content title">
            <h2 class="text-center">RECOMMENDATIONS</h2>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
          </div>
        </div>
        <div id="slide-4"
          class="d-flex flex-row flex-wrap justify-content-center align-content-center
            slide hide-slide animated slide-4"
        >
          <div class="align-self-center content title">
            <h2 class="text-center">Data strategy</h2>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
          </div>
        </div>

        <div id="slide-5"
          class="d-flex flex-row flex-wrap justify-content-center align-content-center
            slide hide-slide animated slide-5"
        >
          <div class="align-self-center content title">
            <h2 class="text-center">Next Steps</h2>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
            <p class="text-justify">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Fusce vel lacus nec risus convallis vestibulum.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import _ from 'lodash';
import { mapGetters, mapActions } from 'vuex';
import { setTimeout } from 'timers';
import SecondaryNav from './navigation/SecondaryNav.vue';

export default {
  name: 'home',
  components: {
    'app-secondary-nav': SecondaryNav,
  },
  data() {
    return {
      touchStartPos: 0,
      touchEndPos: 0,
      swipeDirection: undefined,
    };
  },
  computed: {
    ...mapGetters([
      'getTotalSlides',
      'getPrevSlide',
      'getCurrentSlide',
      'getNextSlide',
      'getFreeScroll',
    ]),
  },
  methods: {
    ...mapActions([
      'setTotalSlides',
      'setPrevSlide',
      'setCurrentSlide',
      'setNextSlide',
      'setFreeScroll',
    ]),
    scrollInit(event) {
      const ELEMTOCHECK = document.querySelector(`#slide-${this.getCurrentSlide} .content`);
      if (ELEMTOCHECK.scrollHeight > ELEMTOCHECK.clientHeight && this.getFreeScroll) {
        console.log('EXIT BECAUSE CUURENT SLIDE IS FREE SCROLL');
        return false;
      }
      const PARENTELEM = document.getElementById('slides-wrap');
      const ELEMTOHIDE = document.getElementById(`slide-${this.getCurrentSlide}`);
      let elemAnimate = document.getElementById(`slide-${this.getNextSlide}`);
      let direction = 'next';
      let prevSlide = this.getPrevSlide;
      let nextSlide = this.getNextSlide;
      if (event.deltaY < 0 || this.swipeDirection === 'prev') {
        // console.log('scrolling up');
        elemAnimate = document.getElementById(`slide-${this.getPrevSlide}`);
        direction = 'prev';
        elemAnimate.classList.remove('hide-slide');
        elemAnimate.classList.add('slide-on-top', 'fadeInDownBig');
      } else if (event.deltaY > 0 || this.swipeDirection === 'next') {
        // console.log('scrolling down');
        elemAnimate = document.getElementById(`slide-${this.getNextSlide}`);
        direction = 'next';
        elemAnimate.classList.remove('hide-slide');
        elemAnimate.classList.add('slide-on-top', 'fadeInUpBig');
      }
      setTimeout(() => {
        PARENTELEM.insertBefore(elemAnimate, PARENTELEM.firstChild);
        elemAnimate.classList.remove('slide-on-top', 'fadeInUpBig', 'fadeInDownBig');
        ELEMTOHIDE.classList.add('hide-slide');
        if (direction === 'next') {
          nextSlide += 1;
          this.setPrevSlide(this.getCurrentSlide);
          this.setCurrentSlide(this.getNextSlide);
          this.setNextSlide(nextSlide);
          if (nextSlide > this.getTotalSlides) {
            this.setNextSlide(1);
          }
        } else {
          prevSlide -= 1;
          this.setNextSlide(this.getCurrentSlide);
          this.setCurrentSlide(this.getPrevSlide);
          this.setPrevSlide(prevSlide);
          if (prevSlide < 1) {
            this.setPrevSlide(this.getTotalSlides);
          }
        }
        this.detectFreeScroll();
      }, 300);
      return true;
    },
    handleScroll: _.debounce(function (event) {
      this.scrollInit(event);
    }, 300, { leading: true, trailing: false }),
    detectFreeScroll() {
      const ELEMTOCHECK = document.querySelector(`#slide-${this.getCurrentSlide} .content`);
      console.log('DETECT SCROLL: ', ELEMTOCHECK.scrollHeight > ELEMTOCHECK.clientHeight);
      if (ELEMTOCHECK.scrollHeight > ELEMTOCHECK.clientHeight) {
        this.setFreeScroll(true);
      }
    },
    throttledMethod: _.throttle(function (event) {
      const ELEMTOCHECK = document.querySelector(`#slide-${this.getCurrentSlide} .content`);
      if (this.getFreeScroll && ELEMTOCHECK.scrollTop >= (ELEMTOCHECK.scrollHeight - ELEMTOCHECK.offsetHeight)) {
        this.setFreeScroll(false);
        this.scrollInit(event);
        console.log('throttleMethod took action');
      } else {
        console.log('throttleMethod no action');
      }
    }, 100),
    handleSwipeStart: _.debounce(function (event) {
      console.log('touch start show just once', event.touches[0].screenY);
      this.touchStartPos = event.touches[0].screenY;
    }, 300, { leading: true, trailing: false }),
    handleSwipeEnd: _.debounce(function (event) {
      console.log('touch end show just once SCREEN END', event.touches[0].screenY);
      this.touchEndPos = event.touches[0].screenY;
      this.swipeDirection = 'next';
      if (this.touchEndPos > this.touchStartPos) {
        this.swipeDirection = 'prev';
      }
      console.log(this.swipeDirection);
      this.scrollInit(event);
    }, 300, { leading: false, trailing: true }),
  },
  created() {
    window.addEventListener('wheel', this.handleScroll, { passive: true });
    window.addEventListener('wheel', this.throttledMethod, { passive: true });
    document.addEventListener('touchstart', this.handleSwipeStart);
    document.addEventListener('touchmove', this.handleSwipeEnd);
    document.addEventListener('touchend', this.throttledMethod);
  },
  mounted() {
    this.setTotalSlides(document.querySelectorAll('.slide').length);
    this.setPrevSlide(this.getTotalSlides);
  },
};
</script>
